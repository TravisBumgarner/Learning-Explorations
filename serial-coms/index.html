<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <button id="arduino-connect">Connect</button>
    <button disabled id="arduino-ping">Ping</button>
    <button disabled id="arduino-on">On</button>
    <button disabled id="arduino-off">Off</button>
    <p>Messages</p>
    <ul id="messages"></ul>
    <script src="./serial-handler.js"></script>
    <script>
      let sh = new SerialHandler();

      const appendMessage = (message) => {
        const node = document.createElement("li");
        node.innerText = message;

        document.getElementById("messages").append(node);
      };

      document
        .getElementById("arduino-connect")
        .addEventListener("click", async () => {
          await sh.init();

          document.getElementById("arduino-connect").disabled = true;
          document.getElementById("arduino-ping").disabled = false;
          document.getElementById("arduino-on").disabled = false;
          document.getElementById("arduino-off").disabled = false;
        });

      document
        .getElementById("arduino-ping")
        .addEventListener("click", async () => {
          console.log("a");
          await sh.write("ping");
          console.log("b");
          const message = await sh.read();
          console.log("c");

          appendMessage(message);
        });

      document
        .getElementById("arduino-on")
        .addEventListener("click", async () => {
          await sh.write("on");
          const message = await sh.read();

          appendMessage(message);
        });

      document
        .getElementById("arduino-off")
        .addEventListener("click", async () => {
          await sh.write("off");
          const message = await sh.read();

          appendMessage(message);
        });
    </script>
  </body>
</html>
